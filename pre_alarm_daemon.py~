#!/bin/python3

import subprocess
import json
from time import strptime

from pprint import pprint

NID = 56
WORK_DIR="/data/data/com.termux/files/home/alarm-light"

def check_for_upcoming_alarm():
    opt = subprocess.Popen("termux-notification-list", stdout=subprocess.PIPE)
    opt.wait()

    notifications = json.loads(str().join([str(l.decode('utf-8').replace('\n', ''))\
            for l in opt.stdout]))

    next_alarm = list()

    for n in notifications:
        if n['packageName'] == "com.google.android.deskclock"\
                and n['title'] == "Upcoming alarm" and int(n['group']) == 1:
                    next_alarm.append(strptime(n['content'].join(''), '%a %H:%M'))


pprint(next_alarm)

def light_switch():
    pass

def notification_switch():
    subprocess.run(["termux-notification", "-i", str(NID),\
            "--ongoing", "--button1", "on",\ 
            "--button1-action",  f"python3 {WORK_DIR}/pre_alarm_daemon.py --on",\
            "--button2", "off",\
            "--button2-action", f"python3 {WOR_DIR}/pre_alarm_daemon.py --off",\
            "-t", "bed light"], check=True)


def send_remote_command():
    pass

def set_time()
    pass

def get_remote_state():
    pass

class 


""" example notification
{
    "id": 13,
    "tag": "",
    "key": "0|com.google.android.deskclock|13|null|10161",
    "group": "1",
    "packageName": "com.google.android.deskclock",
    "title": "Upcoming alarm",
    "content": "Mon 08:00",
    "when": "2023-01-23 07:01:21"
}
"""



